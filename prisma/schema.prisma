// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
    provider = "prisma-client-js"
    output   = "../node_modules/.prisma/client"
}

datasource db {
    provider = "postgresql"
    // NOTE: When using mysql or sqlserver, uncomment the @db.Text annotations in model Account below
    // Further reading:
    // https://next-auth.js.org/adapters/prisma#create-the-prisma-schema
    // https://www.prisma.io/docs/reference/api-reference/prisma-schema-reference#string
    url      = env("DATABASE_URL")
}

model Post {
    id        Int      @id @default(autoincrement())
    name      String
    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt

    createdBy   User   @relation(fields: [createdById], references: [id])
    createdById String

    @@index([name])
}

// Necessary for Next auth
model Account {
    id                       String  @id @default(cuid())
    userId                   String
    type                     String
    provider                 String
    providerAccountId        String
    refresh_token            String? // @db.Text
    access_token             String? // @db.Text
    expires_at               Int?
    token_type               String?
    scope                    String?
    id_token                 String? // @db.Text
    session_state            String?
    user                     User    @relation(fields: [userId], references: [id], onDelete: Cascade)
    refresh_token_expires_in Int?

    @@unique([provider, providerAccountId])
}

model Session {
    id           String   @id @default(cuid())
    sessionToken String   @unique
    userId       String
    expires      DateTime
    user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model User {
    id            String    @id @default(cuid())
    name          String?
    email         String?   @unique
    emailVerified DateTime?
    image         String?
    password      String?
    companyId     String?
    roleId        String?
    accounts      Account[]
    sessions      Session[]
    posts         Post[]
    company       Company?  @relation(fields: [companyId], references: [id])
    role          Role?     @relation(fields: [roleId], references: [id])

    @@index([companyId])
    @@index([roleId])
}

model Company {
    id        String     @id @default(cuid())
    code      String     @unique
    name      String
    createdAt DateTime   @default(now())
    updatedAt DateTime   @updatedAt
    users     User[]
    roles     Role[]
    suppliers Supplier[]
    materials Material[]
    kategoriMaterials KategoriMaterial[]
    satuanMaterials SatuanMaterial[]
    transporters Transporter[]
    penerimaanTBS PenerimaanTBS[]
    stockMaterials StockMaterial[]
    prosesProduksi ProsesProduksi[]
    tangki Tangki[]
    buyers Buyer[]
    contracts Contract[]
    vendors Vendor[]
    pengirimanProduct PengirimanProduct[]
    stockMovements StockMovement[]
    purchaseRequests PurchaseRequest[]

    @@index([code])
}

model Role {
    id          String   @id @default(cuid())
    name        String
    description String?
    permissions Json?
    companyId   String
    createdAt   DateTime @default(now())
    updatedAt   DateTime @updatedAt
    company     Company  @relation(fields: [companyId], references: [id], onDelete: Cascade)
    users       User[]

    @@unique([name, companyId])
    @@index([companyId])
    @@index([name])
}

model VerificationToken {
    identifier String
    token      String   @unique
    expires    DateTime

    @@unique([identifier, token])
}

// Enums for Supplier
enum SupplierType {
    RAMP_PERON
    KUD
    KELOMPOK_TANI
}

enum CertificationType {
    ISPO
    RSPO
}

enum TaxStatus {
    NON_PKP
    PKP_11
    PKP_1_1
}

enum SalesChannel {
    LANGSUNG_PKS
    AGEN
}

enum TransportationType {
    MILIK_SENDIRI
    JASA_PIHAK_KE_3
}

// Model Supplier TBS untuk PT PKS
model Supplier {
    id          String       @id @default(cuid())
    companyId   String
    type        SupplierType
    
    // Identitas
    ownerName         String
    address           String
    companyPhone      String?
    personalPhone     String
    companyName       String?
    rampPeronAddress  String?
    
    // Profil Kebun (JSON array)
    gardenProfiles    Json // Array of { tahunTanam, luasKebun, estimasiSupplyTBS }
    
    // Lokasi
    longitude         Float
    latitude          Float
    
    // Tipe Pengelolaan Kebun
    swadaya           Boolean  @default(false)
    kelompok          Boolean  @default(false)
    perusahaan        Boolean  @default(false)
    jenisBibit        String?
    certificationISPO Boolean  @default(false)
    certificationRSPO Boolean  @default(false)
    
    // Profil Izin Usaha
    aktePendirian     String?
    aktePerubahan     String?
    nib               String?
    siup              String?
    npwp              String?
    
    // Penjualan TBS
    salesChannel      SalesChannel?
    salesChannelDetails String?
    
    // Transportasi
    transportation    TransportationType?
    transportationUnits Int?
    
    // Informasi Rekening
    bankName          String?
    accountNumber     String?
    
    // Status Pajak
    taxStatus         TaxStatus?
    
    createdAt         DateTime @default(now())
    updatedAt         DateTime @updatedAt
    company           Company  @relation(fields: [companyId], references: [id], onDelete: Cascade)
    penerimaanTBS     PenerimaanTBS[]
    supplierTransporters SupplierTransporter[]
    
    @@index([companyId])
    @@index([type])
}

// Model Kategori Material
model KategoriMaterial {
    id          String     @id @default(cuid())
    companyId   String
    name        String
    description String?
    createdAt   DateTime   @default(now())
    updatedAt   DateTime   @updatedAt
    company     Company    @relation(fields: [companyId], references: [id], onDelete: Cascade)
    materials   Material[]
    materialInventaris MaterialInventaris[]
    
    @@unique([name, companyId])
    @@index([companyId])
}

// Model Satuan Material
model SatuanMaterial {
    id        String     @id @default(cuid())
    companyId String
    name      String     // kg, ton, liter, etc
    symbol    String     // simbol satuan
    createdAt DateTime   @default(now())
    updatedAt DateTime   @updatedAt
    company   Company    @relation(fields: [companyId], references: [id], onDelete: Cascade)
    materials Material[]
    materialInventaris MaterialInventaris[]
    
    @@unique([name, companyId])
    @@index([companyId])
}

// Model Material/Barang
model Material {
    id          String           @id @default(cuid())
    companyId   String
    kategoriId  String
    satuanId    String
    name        String
    code        String           @unique
    description String?
    createdAt   DateTime         @default(now())
    updatedAt   DateTime         @updatedAt
    company     Company          @relation(fields: [companyId], references: [id], onDelete: Cascade)
    kategori    KategoriMaterial @relation(fields: [kategoriId], references: [id], onDelete: Cascade)
    satuan      SatuanMaterial   @relation(fields: [satuanId], references: [id], onDelete: Cascade)
    stockMaterial StockMaterial[]
    penerimaanTBS PenerimaanTBS[]
    prosesProduksiInput ProsesProduksi[] @relation("ProsesProduksiInput")
    hasilProduksiOutput HasilProduksi[] @relation("HasilProduksiOutput")
    tangki Tangki[]
    contractItems ContractItem[]
    stockMovements StockMovement[]
    
    @@index([companyId])
    @@index([kategoriId])
    @@index([satuanId])
}

// Model Pengirim/Transporter
model Transporter {
    id           String        @id @default(cuid())
    companyId    String
    nomorKendaraan String
    namaSupir    String
    telepon      String?
    createdAt    DateTime      @default(now())
    updatedAt    DateTime      @updatedAt
    company      Company       @relation(fields: [companyId], references: [id], onDelete: Cascade)
    penerimaanTBS PenerimaanTBS[]
    supplierTransporters SupplierTransporter[]
    
    @@unique([nomorKendaraan, companyId])
    @@index([companyId])
}

// Junction table untuk relasi many-to-many Supplier dan Transporter
model SupplierTransporter {
    id            String      @id @default(cuid())
    supplierId    String
    transporterId String
    createdAt     DateTime    @default(now())
    supplier      Supplier    @relation(fields: [supplierId], references: [id], onDelete: Cascade)
    transporter   Transporter @relation(fields: [transporterId], references: [id], onDelete: Cascade)
    
    @@unique([supplierId, transporterId])
    @@index([supplierId])
    @@index([transporterId])
}

// Enum untuk status penerimaan
enum StatusPenerimaan {
    DRAFT
    COMPLETED
    CANCELLED
}

// Enum untuk metode input timbangan
enum MetodeInput {
    MANUAL
    SISTEM_TIMBANGAN
}

// Model Penerimaan TBS
model PenerimaanTBS {
    id                String           @id @default(cuid())
    companyId         String
    nomorPenerimaan   String           @unique
    tanggalTerima     DateTime
    materialId        String
    operatorPenimbang String           // username dari user yang login
    supplierId        String
    lokasiKebun       String?          // Lokasi kebun supplier
    jenisBuah         String?          // TBS-BB (Buah Besar), TBS-BS (Buah Biasa), TBS-BK (Buah Kecil)
    transporterId     String
    
    // Timbangan
    beratBruto        Float
    waktuTimbangBruto DateTime
    metodeBruto       MetodeInput      @default(MANUAL)
    
    beratTarra        Float
    waktuTimbangTarra DateTime
    metodeTarra       MetodeInput      @default(MANUAL)
    
    beratNetto1       Float            // bruto - tarra (auto kalkulasi)
    
    // Potongan
    potonganPersen    Float            @default(0)
    potonganKg        Float            @default(0) // auto kalkulasi dari potonganPersen
    
    beratNetto2       Float            // netto1 - potonganKg (final)
    
    // Harga
    hargaPerKg        Float
    totalBayar        Float            // netto2 * hargaPerKg
    
    // Upah Bongkar
    upahBongkar       Float            @default(16) // upah per kg
    totalUpahBongkar  Float            @default(0)  // netto2 * upahBongkar
    
    status            StatusPenerimaan @default(DRAFT)
    
    createdAt         DateTime         @default(now())
    updatedAt         DateTime         @updatedAt
    
    company           Company          @relation(fields: [companyId], references: [id], onDelete: Cascade)
    material          Material         @relation(fields: [materialId], references: [id], onDelete: Cascade)
    supplier          Supplier         @relation(fields: [supplierId], references: [id], onDelete: Cascade)
    transporter       Transporter      @relation(fields: [transporterId], references: [id], onDelete: Cascade)
    
    @@index([companyId])
    @@index([materialId])
    @@index([supplierId])
    @@index([transporterId])
    @@index([tanggalTerima])
    @@index([status])
}

// Model Stock Material
model StockMaterial {
    id         String   @id @default(cuid())
    companyId  String
    materialId String
    jumlah     Float    @default(0)
    createdAt  DateTime @default(now())
    updatedAt  DateTime @updatedAt
    company    Company  @relation(fields: [companyId], references: [id], onDelete: Cascade)
    material   Material @relation(fields: [materialId], references: [id], onDelete: Cascade)
    
    @@unique([companyId, materialId])
    @@index([companyId])
    @@index([materialId])
}

// Enum untuk status proses produksi
enum StatusProsesProduksi {
    DRAFT
    IN_PROGRESS
    COMPLETED
    CANCELLED
}

// Model Proses Produksi
model ProsesProduksi {
    id                String               @id @default(cuid())
    companyId         String
    nomorProduksi     String               @unique
    tanggalProduksi   DateTime
    operatorProduksi  String               // username dari user yang login
    
    // Material Input (TBS)
    materialInputId   String               // Material TBS yang akan diolah
    jumlahInput       Float                // Total TBS yang akan diolah (dalam kg/ton)
    
    status            StatusProsesProduksi @default(DRAFT)
    
    createdAt         DateTime             @default(now())
    updatedAt         DateTime             @updatedAt
    
    company           Company              @relation(fields: [companyId], references: [id], onDelete: Cascade)
    materialInput     Material             @relation("ProsesProduksiInput", fields: [materialInputId], references: [id], onDelete: Cascade)
    hasilProduksi     HasilProduksi[]
    
    @@index([companyId])
    @@index([materialInputId])
    @@index([tanggalProduksi])
    @@index([status])
}

// Model Hasil Produksi (Output dari proses produksi)
model HasilProduksi {
    id                String          @id @default(cuid())
    prosesProduksiId  String
    materialOutputId  String          // Material hasil produksi (CPO, Kernel, dll)
    jumlahOutput      Float           // Total hasil produksi (dalam kg/ton)
    rendemen          Float           // Rendemen dalam persen (jumlahOutput / jumlahInput * 100)
    
    createdAt         DateTime        @default(now())
    updatedAt         DateTime        @updatedAt
    
    prosesProduksi    ProsesProduksi  @relation(fields: [prosesProduksiId], references: [id], onDelete: Cascade)
    materialOutput    Material        @relation("HasilProduksiOutput", fields: [materialOutputId], references: [id], onDelete: Cascade)
    
    @@index([prosesProduksiId])
    @@index([materialOutputId])
}

// Model Tangki (Tank) untuk penyimpanan hasil produksi
model Tangki {
    id          String   @id @default(cuid())
    companyId   String
    materialId  String   // Material yang disimpan (CPO, Kernel, dll)
    namaTangki  String   // Nama tangki (T-001, Tank A, dll)
    kapasitas   Float    // Kapasitas maksimal tangki (dalam kg/liter)
    isiSaatIni  Float    @default(0) // Isi tangki saat ini
    
    createdAt   DateTime @default(now())
    updatedAt   DateTime @updatedAt
    
    company     Company  @relation(fields: [companyId], references: [id], onDelete: Cascade)
    material    Material @relation(fields: [materialId], references: [id], onDelete: Cascade)
    riwayatStockTangki StockTangki[]
    
    @@unique([companyId, namaTangki])
    @@index([companyId])
    @@index([materialId])
}

// Enum untuk tipe transaksi stock tangki
enum TipeTransaksiTangki {
    MASUK      // Dari hasil produksi
    KELUAR     // Untuk pengiriman/penjualan
    TRANSFER   // Transfer antar tangki
    ADJUSTMENT // Penyesuaian stock
}

// Model Riwayat Stock Tangki
model StockTangki {
    id                String              @id @default(cuid())
    tangkiId          String
    tipeTransaksi     TipeTransaksiTangki
    jumlah            Float               // Jumlah yang masuk/keluar
    stockSebelum      Float               // Stock sebelum transaksi
    stockSesudah      Float               // Stock setelah transaksi
    referensi         String?             // Nomor referensi (nomor produksi, DO, dll)
    keterangan        String?             // Keterangan tambahan
    operator          String              // Username operator
    tanggalTransaksi  DateTime            @default(now())
    
    createdAt         DateTime            @default(now())
    
    tangki            Tangki              @relation(fields: [tangkiId], references: [id], onDelete: Cascade)
    
    @@index([tangkiId])
    @@index([tanggalTransaksi])
    @@index([tipeTransaksi])
}

// Enum untuk status buyer
enum StatusBuyer {
    ACTIVE
    INACTIVE
}

// Enum untuk status vendor
enum StatusVendor {
    ACTIVE
    INACTIVE
}

// Model Buyer (Pembeli/Customer)
model Buyer {
    id              String       @id @default(cuid())
    companyId       String
    
    // Informasi Umum
    code            String       @unique // Kode buyer (auto-generated atau manual)
    name            String       // Nama perusahaan/buyer
    contactPerson   String       // Nama contact person
    email           String?      // Email buyer
    phone           String       // Nomor telepon
    address         String       // Alamat lengkap
    
    // Informasi Pajak
    npwp            String?      // NPWP buyer
    taxStatus       TaxStatus    // Status pajak (NON_PKP, PKP_11, PKP_1_1)
    
    // Informasi Rekening
    bankName        String?      // Nama bank
    accountNumber   String?      // Nomor rekening
    accountName     String?      // Nama pemilik rekening
    
    // Status
    status          StatusBuyer  @default(ACTIVE)
    
    createdAt       DateTime     @default(now())
    updatedAt       DateTime     @updatedAt
    
    company         Company      @relation(fields: [companyId], references: [id], onDelete: Cascade)
    contracts       Contract[]
    pengirimanProduct PengirimanProduct[]
    
    @@index([companyId])
    @@index([code])
    @@index([status])
}

// Enum untuk status kontrak
enum StatusContract {
    DRAFT
    ACTIVE
    COMPLETED
    CANCELLED
}

// Model Contract (Kontrak Pembelian)
model Contract {
    id                  String         @id @default(cuid())
    companyId           String
    buyerId             String
    
    // Informasi Kontrak
    contractNumber      String         @unique // Nomor kontrak (auto-generated)
    contractDate        DateTime       // Tanggal kontrak dibuat
    startDate           DateTime       // Tanggal mulai kontrak
    endDate             DateTime       // Tanggal berakhir kontrak
    
    // Informasi Pengiriman
    deliveryDate        DateTime       // Tanggal pengiriman
    deliveryAddress     String         // Alamat pengiriman
    
    // Harga dan Pajak
    subtotal            Float          @default(0) // Total sebelum pajak (auto-calculated)
    taxAmount           Float          @default(0) // Jumlah pajak (auto-calculated based on buyer taxStatus)
    totalAmount         Float          @default(0) // Total setelah pajak (auto-calculated)
    
    // Status
    status              StatusContract @default(DRAFT)
    
    // Catatan
    notes               String?        // Catatan tambahan
    
    createdAt           DateTime       @default(now())
    updatedAt           DateTime       @updatedAt
    
    company             Company        @relation(fields: [companyId], references: [id], onDelete: Cascade)
    buyer               Buyer          @relation(fields: [buyerId], references: [id], onDelete: Cascade)
    contractItems       ContractItem[]
    pengirimanProduct   PengirimanProduct[]
    
    @@index([companyId])
    @@index([buyerId])
    @@index([contractNumber])
    @@index([status])
    @@index([deliveryDate])
}

// Model ContractItem (Item dalam Kontrak)
model ContractItem {
    id          String   @id @default(cuid())
    contractId  String
    materialId  String
    
    // Detail Item
    quantity          Float    // Jumlah/kuantitas kontrak (tidak berubah)
    deliveredQuantity Float    @default(0) // Jumlah yang sudah dikirim
    unitPrice         Float    // Harga per satuan
    totalPrice        Float    // Total harga item (quantity * unitPrice) - auto-calculated
    
    // Catatan
    notes       String?  // Catatan untuk item ini
    
    createdAt   DateTime @default(now())
    updatedAt   DateTime @updatedAt
    
    contract    Contract @relation(fields: [contractId], references: [id], onDelete: Cascade)
    material    Material @relation(fields: [materialId], references: [id], onDelete: Cascade)
    pengirimanProduct PengirimanProduct[]
    
    @@index([contractId])
    @@index([materialId])
}

// Model Vendor (Vendor Transportir/Perusahaan)
model Vendor {
    id              String          @id @default(cuid())
    companyId       String
    
    // Informasi Umum
    code            String          @unique // Kode vendor (auto-generated)
    name            String          // Nama vendor/perusahaan transportir
    contactPerson   String          // Nama contact person
    email           String?         // Email vendor
    phone           String          // Nomor telepon
    address         String          // Alamat lengkap
    
    // Informasi Pajak
    npwp            String?         // NPWP vendor
    taxStatus       TaxStatus       // Status pajak (NON_PKP, PKP_11, PKP_1_1)
    
    // Informasi Rekening
    bankName        String?         // Nama bank
    accountNumber   String?         // Nomor rekening
    accountName     String?         // Nama pemilik rekening
    
    // Status
    status          StatusVendor    @default(ACTIVE)
    
    createdAt       DateTime        @default(now())
    updatedAt       DateTime        @updatedAt
    
    company         Company         @relation(fields: [companyId], references: [id], onDelete: Cascade)
    vehicles        VendorVehicle[] // Relasi ke kendaraan
    
    @@index([companyId])
    @@index([code])
    @@index([status])
}

// Model VendorVehicle (Kendaraan dan Supir milik Vendor)
model VendorVehicle {
    id              String       @id @default(cuid())
    vendorId        String
    
    // Informasi Kendaraan
    nomorKendaraan  String       // Nomor polisi kendaraan
    
    // Informasi Supir
    namaSupir       String       // Nama supir
    noHpSupir       String?      // Nomor HP supir
    
    // Status
    status          StatusVendor @default(ACTIVE)
    
    createdAt       DateTime     @default(now())
    updatedAt       DateTime     @updatedAt
    
    vendor          Vendor       @relation(fields: [vendorId], references: [id], onDelete: Cascade)
    pengirimanProduct PengirimanProduct[]
    
    @@unique([nomorKendaraan, vendorId])
    @@index([vendorId])
    @@index([status])
}

// Enum untuk status pengiriman product
enum StatusPengiriman {
    DRAFT
    COMPLETED
    CANCELLED
}

// Model Pengiriman Product (Penjualan & Pengiriman)
model PengirimanProduct {
    id                   String            @id @default(cuid())
    companyId            String
    nomorPengiriman      String            @unique
    tanggalPengiriman    DateTime
    operatorPenimbang    String            // username dari user yang login
    
    // Informasi Penerima
    buyerId              String
    contractId           String
    contractItemId       String            // Item spesifik dari kontrak yang dikirim
    
    // Informasi Vendor Transportir
    vendorVehicleId      String
    
    // Timbangan (Tarra dulu, baru Gross)
    beratTarra           Float
    waktuTimbangTarra    DateTime
    metodeTarra          MetodeInput       @default(MANUAL)
    
    beratGross           Float
    waktuTimbangGross    DateTime
    metodeGross          MetodeInput       @default(MANUAL)
    
    beratNetto           Float             // gross - tarra (auto kalkulasi)
    
    // Mutu Kernel
    ffa                  Float             // Free Fatty Acid
    air                  Float             // Kadar air
    kotoran              Float             // Kadar kotoran
    noSegel              String            @unique // No segel (auto-generated)
    
    status               StatusPengiriman  @default(DRAFT)
    
    createdAt            DateTime          @default(now())
    updatedAt            DateTime          @updatedAt
    
    company              Company           @relation(fields: [companyId], references: [id], onDelete: Cascade)
    buyer                Buyer             @relation(fields: [buyerId], references: [id], onDelete: Cascade)
    contract             Contract          @relation(fields: [contractId], references: [id], onDelete: Cascade)
    contractItem         ContractItem      @relation(fields: [contractItemId], references: [id], onDelete: Cascade)
    vendorVehicle        VendorVehicle     @relation(fields: [vendorVehicleId], references: [id], onDelete: Cascade)
    
    @@index([companyId])
    @@index([buyerId])
    @@index([contractId])
    @@index([contractItemId])
    @@index([vendorVehicleId])
    @@index([tanggalPengiriman])
    @@index([status])
}

// Enum untuk tipe pergerakan stock
enum TipeMovement {
    IN        // Barang masuk (dari penerimaan, produksi)
    OUT       // Barang keluar (pengiriman/penjualan)
    ADJUSTMENT // Penyesuaian stock
}

// Model Stock Movement (Riwayat pergerakan stock)
model StockMovement {
    id                String        @id @default(cuid())
    companyId         String
    materialId        String
    tipeMovement      TipeMovement
    jumlah            Float         // Jumlah yang masuk/keluar
    stockSebelum      Float         // Stock sebelum transaksi
    stockSesudah      Float         // Stock setelah transaksi
    referensi         String?       // Nomor referensi (nomor penerimaan, pengiriman, dll)
    keterangan        String?       // Keterangan tambahan
    operator          String        // Username operator
    tanggalTransaksi  DateTime      @default(now())
    
    createdAt         DateTime      @default(now())
    
    company           Company       @relation(fields: [companyId], references: [id], onDelete: Cascade)
    material          Material      @relation(fields: [materialId], references: [id], onDelete: Cascade)
    
    @@index([companyId])
    @@index([materialId])
    @@index([tanggalTransaksi])
    @@index([tipeMovement])
}

// ============================================
// MODUL INVENTARIS GUDANG
// ============================================

// Enum untuk status Store Request (SR)
enum StatusStoreRequest {
    DRAFT           // Draft, belum disubmit
    PENDING         // Menunggu approval
    APPROVED        // Disetujui, siap diproses
    COMPLETED       // Selesai (barang sudah dikeluarkan)
    REJECTED        // Ditolak
    NEED_PR         // Perlu Purchase Request (stok habis)
    CANCELLED       // Dibatalkan
}

// Enum untuk status Purchase Request (PR)
enum StatusPurchaseRequest {
    DRAFT           // Draft, belum disubmit
    PENDING         // Menunggu approval
    APPROVED        // Disetujui
    REJECTED        // Ditolak
    PO_CREATED      // PO sudah dibuat (untuk tipe PENGAJUAN_PO)
    COMPLETED       // Selesai (untuk tipe PEMBELIAN_LANGSUNG setelah barang diterima)
    CANCELLED       // Dibatalkan
}

// Enum untuk tipe pembelian Purchase Request
enum TipePembelianPR {
    PEMBELIAN_LANGSUNG    // Direct purchase - langsung ke penerimaan barang
    PENGAJUAN_PO          // Submit to PO - masuk ke PO untuk diproses
}

// Enum untuk status Purchase Order (PO)
enum StatusPurchaseOrder {
    DRAFT           // Draft, belum disubmit
    ISSUED          // PO sudah diterbitkan ke vendor
    PARTIAL_RECEIVED // Sebagian barang sudah diterima
    COMPLETED       // Semua barang sudah diterima
    CANCELLED       // Dibatalkan
}

// Enum untuk status Penerimaan Barang
enum StatusPenerimaanBarang {
    DRAFT           // Draft, sedang input
    COMPLETED       // Selesai dan sudah masuk ke stok
    CANCELLED       // Dibatalkan
}

// Enum untuk status Pengeluaran Barang
enum StatusPengeluaranBarang {
    DRAFT           // Draft, belum disubmit
    PENDING         // Menunggu approval
    APPROVED        // Disetujui
    COMPLETED       // Barang sudah dikeluarkan
    REJECTED        // Ditolak
    CANCELLED       // Dibatalkan
}

// Model Store Request (SR) - Permintaan Barang dari Divisi
model StoreRequest {
    id                    String             @id @default(cuid())
    companyId             String
    nomorSR               String             @unique
    tanggalRequest        DateTime           @default(now())
    divisi                String             // Divisi yang request
    requestedBy           String             // Username/nama yang request
    approvedBy            String?            // Username/nama yang approve (Asisten/Mandor)
    tanggalApproval       DateTime?
    keterangan            String?
    status                StatusStoreRequest @default(DRAFT)
    
    createdAt             DateTime           @default(now())
    updatedAt             DateTime           @updatedAt
    
    items                 StoreRequestItem[]
    pengeluaranBarang     PengeluaranBarang?
    purchaseRequest       PurchaseRequest?
    
    @@index([companyId])
    @@index([tanggalRequest])
    @@index([status])
    @@index([divisi])
}

// Item Store Request
model StoreRequestItem {
    id              String        @id @default(cuid())
    storeRequestId  String
    materialId      String
    jumlahRequest   Float
    keterangan      String?
    
    createdAt       DateTime      @default(now())
    updatedAt       DateTime      @updatedAt
    
    storeRequest    StoreRequest  @relation(fields: [storeRequestId], references: [id], onDelete: Cascade)
    material        MaterialInventaris @relation(fields: [materialId], references: [id], onDelete: Cascade)
    
    @@index([storeRequestId])
    @@index([materialId])
}

// Model Purchase Request (PR) - Permintaan Pembelian dari Gudang ke Head Office
model PurchaseRequest {
    id                    String                 @id @default(cuid())
    companyId             String
    nomorPR               String                 @unique
    tanggalRequest        DateTime               @default(now())
    tipePembelian         TipePembelianPR        @default(PENGAJUAN_PO) // Tipe pembelian
    storeRequestId        String?                @unique // Bisa dari SR atau buat manual
    divisi                String?                // Divisi yang mengajukan
    requestedBy           String                 // Adm Gudang
    approvedBy            String?                // Head Office/Procurement
    tanggalApproval       DateTime?
    
    // Field khusus untuk pembelian langsung
    vendorNameDirect      String?                // Nama vendor (untuk pembelian langsung)
    vendorAddressDirect   String?                // Alamat vendor (untuk pembelian langsung)
    vendorPhoneDirect     String?                // Telepon vendor (untuk pembelian langsung)
    
    keterangan            String?
    status                StatusPurchaseRequest  @default(DRAFT)
    
    createdAt             DateTime               @default(now())
    updatedAt             DateTime               @updatedAt
    
    company               Company                @relation(fields: [companyId], references: [id], onDelete: Cascade)
    storeRequest          StoreRequest?          @relation(fields: [storeRequestId], references: [id])
    items                 PurchaseRequestItem[]
    purchaseOrder         PurchaseOrder?
    penerimaanBarang      PenerimaanBarang[]     // Relasi ke penerimaan barang (untuk pembelian langsung)
    pembayaranPR          PembayaranPR[]         // Pembayaran untuk PR pembelian langsung
    
    @@index([companyId])
    @@index([tanggalRequest])
    @@index([status])
    @@index([tipePembelian])
    @@index([storeRequestId])
}

// Item Purchase Request
model PurchaseRequestItem {
    id                String          @id @default(cuid())
    purchaseRequestId String
    materialId        String
    jumlahRequest     Float
    estimasiHarga     Float?          // Estimasi harga satuan
    keterangan        String?
    
    createdAt         DateTime        @default(now())
    updatedAt         DateTime        @updatedAt
    
    purchaseRequest   PurchaseRequest @relation(fields: [purchaseRequestId], references: [id], onDelete: Cascade)
    material          MaterialInventaris @relation(fields: [materialId], references: [id], onDelete: Cascade)
    
    @@index([purchaseRequestId])
    @@index([materialId])
}

// Model Purchase Order (PO) - Order Pembelian ke Vendor
model PurchaseOrder {
    id                    String               @id @default(cuid())
    companyId             String
    nomorPO               String               @unique
    tanggalPO             DateTime             @default(now())
    purchaseRequestId     String?              @unique
    vendorName            String               // Nama vendor (input teks)
    vendorAddress         String?
    vendorPhone           String?
    
    tanggalKirimDiharapkan DateTime?          // Expected delivery date
    termPembayaran        String?              // Net 30, Net 60, dll
    
    issuedBy              String               // Username yang menerbitkan PO
    approvedBy            String?              // Username yang approve
    tanggalApproval       DateTime?
    
    subtotal              Float                @default(0)
    taxPercent            Float                @default(0)  // PPN dalam persen (%)
    taxAmount             Float                @default(0)  // Jumlah PPN (auto-calculated)
    discountType          String?              // PERCENT atau AMOUNT
    discountPercent       Float                @default(0)  // Diskon dalam persen (%)
    discountAmount        Float                @default(0)  // Jumlah diskon (jika tipe AMOUNT atau auto-calculated jika PERCENT)
    shipping              Float                @default(0)  // Biaya kirim
    totalAmount           Float                @default(0)  // Total keseluruhan
    
    // PDF Brosur/Lampiran
    brosurPdfPath         String?              // Path ke file PDF brosur
    brosurPdfName         String?              // Nama file asli
    
    keterangan            String?
    status                StatusPurchaseOrder  @default(DRAFT)
    
    createdAt             DateTime             @default(now())
    updatedAt             DateTime             @updatedAt
    
    purchaseRequest       PurchaseRequest?     @relation(fields: [purchaseRequestId], references: [id])
    items                 PurchaseOrderItem[]
    penerimaanBarang      PenerimaanBarang[]
    pembayaranPO          PembayaranPO[]       // Pembayaran untuk PO
    
    @@index([companyId])
    @@index([tanggalPO])
    @@index([status])
    @@index([purchaseRequestId])
}

// Item Purchase Order
model PurchaseOrderItem {
    id              String         @id @default(cuid())
    purchaseOrderId String
    materialId      String
    jumlahOrder     Float
    hargaSatuan     Float
    subtotal        Float          // jumlahOrder * hargaSatuan
    jumlahDiterima  Float          @default(0) // Total yang sudah diterima
    keterangan      String?
    
    createdAt       DateTime       @default(now())
    updatedAt       DateTime       @updatedAt
    
    purchaseOrder   PurchaseOrder  @relation(fields: [purchaseOrderId], references: [id], onDelete: Cascade)
    material        MaterialInventaris @relation(fields: [materialId], references: [id], onDelete: Cascade)
    penerimaanBarangItems PenerimaanBarangItem[]
    
    @@index([purchaseOrderId])
    @@index([materialId])
}

// Model Penerimaan Barang - Barang Masuk Gudang
model PenerimaanBarang {
    id                    String                  @id @default(cuid())
    companyId             String
    nomorPenerimaan       String                  @unique
    tanggalPenerimaan     DateTime                @default(now())
    purchaseOrderId       String?                 // Dari PO (optional)
    purchaseRequestId     String?                 // Dari PR langsung (optional)
    vendorId              String
    vendorName            String                  // Denormalisasi
    nomorSuratJalan       String?                 // Nomor surat jalan dari vendor
    tanggalSuratJalan     DateTime?
    nomorInvoice          String?                 // Nomor invoice dari vendor
    tanggalInvoice        DateTime?
    
    receivedBy            String                  // Username adm gudang yang terima
    checkedBy             String?                 // Username yang cek barang
    
    keterangan            String?
    status                StatusPenerimaanBarang  @default(DRAFT)
    
    createdAt             DateTime                @default(now())
    updatedAt             DateTime                @updatedAt
    
    purchaseOrder         PurchaseOrder?          @relation(fields: [purchaseOrderId], references: [id])
    purchaseRequest       PurchaseRequest?        @relation(fields: [purchaseRequestId], references: [id])
    items                 PenerimaanBarangItem[]
    
    @@index([companyId])
    @@index([tanggalPenerimaan])
    @@index([status])
    @@index([vendorId])
    @@index([purchaseOrderId])
    @@index([purchaseRequestId])
}

// Item Penerimaan Barang
model PenerimaanBarangItem {
    id                  String            @id @default(cuid())
    penerimaanBarangId  String
    materialId          String
    purchaseOrderItemId String?           // Link ke PO item jika ada
    jumlahDiterima      Float
    hargaSatuan         Float
    totalHarga          Float             // jumlahDiterima * hargaSatuan
    lokasiPenyimpanan   String?           // Lokasi di gudang
    keterangan          String?
    
    createdAt           DateTime          @default(now())
    updatedAt           DateTime          @updatedAt
    
    penerimaanBarang    PenerimaanBarang  @relation(fields: [penerimaanBarangId], references: [id], onDelete: Cascade)
    material            MaterialInventaris @relation(fields: [materialId], references: [id], onDelete: Cascade)
    purchaseOrderItem   PurchaseOrderItem? @relation(fields: [purchaseOrderItemId], references: [id])
    
    @@index([penerimaanBarangId])
    @@index([materialId])
    @@index([purchaseOrderItemId])
}

// Model Pengeluaran Barang - Barang Keluar dari Gudang
model PengeluaranBarang {
    id                    String                   @id @default(cuid())
    companyId             String
    nomorPengeluaran      String                   @unique
    tanggalPengeluaran    DateTime                 @default(now())
    storeRequestId        String?                  @unique // Link ke SR jika ada
    divisi                String                   // Divisi penerima
    requestedBy           String                   // Nama yang request
    approvedBy            String?                  // Atasan yang approve
    tanggalApproval       DateTime?
    issuedBy              String?                  // Username adm gudang yang keluarkan barang
    receivedByDivisi      String?                  // Nama yang terima dari divisi
    tanggalDiterima       DateTime?
    
    keterangan            String?
    status                StatusPengeluaranBarang  @default(DRAFT)
    
    createdAt             DateTime                 @default(now())
    updatedAt             DateTime                 @updatedAt
    
    storeRequest          StoreRequest?            @relation(fields: [storeRequestId], references: [id])
    items                 PengeluaranBarangItem[]
    
    @@index([companyId])
    @@index([tanggalPengeluaran])
    @@index([status])
    @@index([divisi])
    @@index([storeRequestId])
}

// Item Pengeluaran Barang
model PengeluaranBarangItem {
    id                  String             @id @default(cuid())
    pengeluaranBarangId String
    materialId          String
    jumlahKeluar        Float
    hargaSatuan         Float              // Harga rata-rata dari stok
    totalHarga          Float              // jumlahKeluar * hargaSatuan
    keterangan          String?
    
    createdAt           DateTime           @default(now())
    updatedAt           DateTime           @updatedAt
    
    pengeluaranBarang   PengeluaranBarang  @relation(fields: [pengeluaranBarangId], references: [id], onDelete: Cascade)
    material            MaterialInventaris @relation(fields: [materialId], references: [id], onDelete: Cascade)
    
    @@index([pengeluaranBarangId])
    @@index([materialId])
}

// Model Material Inventaris - Master data material untuk inventaris
model MaterialInventaris {
    id                    String                    @id @default(cuid())
    companyId             String
    partNumber            String                    // Part number/kode barang
    namaMaterial          String
    kategoriMaterialId    String
    satuanMaterialId      String
    lokasiDigunakan       String?                   // Lokasi penggunaan (divisi, area, dll)
    spesifikasi           String?                   // Spesifikasi material
    hargaSatuan           Float?                    @default(0) // Harga per satuan
    minStock              Float                     @default(0) // Minimum stock alert
    maxStock              Float                     @default(0) // Maximum stock capacity
    stockOnHand           Float                     @default(0) // Stock saat ini
    
    createdAt             DateTime                  @default(now())
    updatedAt             DateTime                  @updatedAt
    
    kategoriMaterial      KategoriMaterial          @relation(fields: [kategoriMaterialId], references: [id])
    satuanMaterial        SatuanMaterial            @relation(fields: [satuanMaterialId], references: [id])
    
    storeRequestItems     StoreRequestItem[]
    purchaseRequestItems  PurchaseRequestItem[]
    purchaseOrderItems    PurchaseOrderItem[]
    penerimaanBarangItems PenerimaanBarangItem[]
    pengeluaranBarangItems PengeluaranBarangItem[]
    inventoryTransactions InventoryTransaction[]
    
    @@unique([partNumber, companyId])
    @@index([companyId])
    @@index([kategoriMaterialId])
    @@index([satuanMaterialId])
    @@index([partNumber])
}

// Model Inventory Transaction - Transaksi detail inventaris
model InventoryTransaction {
    id                  String              @id @default(cuid())
    companyId           String
    materialId          String
    tanggalTransaksi    DateTime            @default(now())
    tipeTransaksi       TipeMovement        // IN, OUT, ADJUSTMENT
    referensi           String?             // Nomor penerimaan/pengeluaran/SR/PR/PO
    vendorId            String?
    vendorName          String?
    jumlahMasuk         Float               @default(0) // Received
    jumlahKeluar        Float               @default(0) // Issuing
    stockOnHand         Float               // Stock setelah transaksi
    hargaSatuan         Float               @default(0)
    totalHarga          Float               @default(0)
    keterangan          String?
    operator            String              // Username operator
    
    createdAt           DateTime            @default(now())
    
    material            MaterialInventaris  @relation(fields: [materialId], references: [id], onDelete: Cascade)
    
    @@index([companyId])
    @@index([materialId])
    @@index([tanggalTransaksi])
    @@index([tipeTransaksi])
    @@index([vendorId])
}

// ============================================
// MODUL KEUANGAN
// ============================================

// Enum untuk status pembayaran
enum StatusPembayaran {
    UNPAID      // Belum dibayar
    PARTIAL     // Sebagian dibayar
    PAID        // Sudah dibayar lunas
}

// Enum untuk tipe hutang/piutang
enum TipeTransaksiKeuangan {
    PENERIMAAN_TBS      // Hutang dari pembelian TBS ke supplier
    PURCHASE_ORDER      // Hutang dari PO ke vendor
    PEMBELIAN_LANGSUNG  // Hutang dari PR pembelian langsung
    PENGIRIMAN_PRODUCT  // Piutang dari pengiriman product ke buyer
}

// Model Hutang (Payable) - Track semua yang harus dibayar ke supplier/vendor
model Hutang {
    id                    String                   @id @default(cuid())
    companyId             String
    
    tipeTransaksi         TipeTransaksiKeuangan    
    referensiId           String                   // ID dari penerimaan TBS/PO/PR
    referensiNomor        String                   // Nomor referensi
    tanggalTransaksi      DateTime                 
    tanggalJatuhTempo     DateTime?                // Tanggal jatuh tempo pembayaran
    
    // Informasi Pihak Ketiga
    pihakKetigaId         String?                  // ID Supplier/Vendor
    pihakKetigaNama       String                   // Nama Supplier/Vendor
    pihakKetigaTipe       String?                  // SUPPLIER / VENDOR
    
    // Nilai
    totalNilai            Float                    // Total nilai hutang
    totalDibayar          Float                    @default(0) // Total yang sudah dibayar
    sisaHutang            Float                    // Sisa hutang (totalNilai - totalDibayar)
    
    // Status
    status                StatusPembayaran         @default(UNPAID)
    
    // Catatan
    keterangan            String?
    
    createdAt             DateTime                 @default(now())
    updatedAt             DateTime                 @updatedAt
    
    pembayaranHutang      PembayaranHutang[]
    
    @@index([companyId])
    @@index([tipeTransaksi])
    @@index([status])
    @@index([tanggalTransaksi])
    @@index([pihakKetigaId])
}

// Model Pembayaran Hutang - Record setiap pembayaran
model PembayaranHutang {
    id                    String    @id @default(cuid())
    hutangId              String
    
    tanggalBayar          DateTime  @default(now())
    jumlahBayar           Float
    metodePembayaran      String?   // CASH, TRANSFER, GIRO, dll
    nomorReferensi        String?   // Nomor bukti bayar
    keterangan            String?
    dibayarOleh           String    // Username yang mencatat pembayaran
    
    createdAt             DateTime  @default(now())
    
    hutang                Hutang    @relation(fields: [hutangId], references: [id], onDelete: Cascade)
    
    @@index([hutangId])
    @@index([tanggalBayar])
}

// Model Piutang (Receivable) - Track semua yang harus diterima dari buyer
model Piutang {
    id                    String                   @id @default(cuid())
    companyId             String
    
    tipeTransaksi         TipeTransaksiKeuangan    @default(PENGIRIMAN_PRODUCT)
    referensiId           String                   // ID dari pengiriman product
    referensiNomor        String                   // Nomor pengiriman
    tanggalTransaksi      DateTime                 
    tanggalJatuhTempo     DateTime?                // Tanggal jatuh tempo pembayaran
    
    // Informasi Buyer
    buyerId               String?
    buyerNama             String
    contractId            String?                  // ID Kontrak terkait
    contractNumber        String?                  // Nomor kontrak
    
    // Nilai
    totalNilai            Float                    // Total nilai piutang
    totalDiterima         Float                    @default(0) // Total yang sudah diterima
    sisaPiutang           Float                    // Sisa piutang (totalNilai - totalDiterima)
    
    // Status
    status                StatusPembayaran         @default(UNPAID)
    
    // Catatan
    keterangan            String?
    
    createdAt             DateTime                 @default(now())
    updatedAt             DateTime                 @updatedAt
    
    penerimaanPiutang     PenerimaanPiutang[]
    
    @@index([companyId])
    @@index([status])
    @@index([tanggalTransaksi])
    @@index([buyerId])
    @@index([contractId])
}

// Model Penerimaan Piutang - Record setiap pembayaran dari buyer
model PenerimaanPiutang {
    id                    String    @id @default(cuid())
    piutangId             String
    
    tanggalTerima         DateTime  @default(now())
    jumlahTerima          Float
    metodePembayaran      String?   // CASH, TRANSFER, GIRO, dll
    nomorReferensi        String?   // Nomor bukti terima
    keterangan            String?
    diterimaOleh          String    // Username yang mencatat penerimaan
    
    createdAt             DateTime  @default(now())
    
    piutang               Piutang   @relation(fields: [piutangId], references: [id], onDelete: Cascade)
    
    @@index([piutangId])
    @@index([tanggalTerima])
}

// ============================================
// MODUL PENGGAJIAN KARYAWAN
// ============================================

// Master Data Karyawan - Data tetap karyawan
model MasterKaryawan {
    id                    String   @id @default(cuid())
    
    // Identitas Karyawan
    namaKaryawan          String   // NAMA KARYAWAN
    tktk                  String?  // TK/K (Status keluarga)
    gol                   String?  // GOL (Golongan)
    nomorRekening         String?  // NOMOR REKENING
    devisi                String?  // DEVISI
    noBpjsTk              String?  // NO BPJS TK
    noBpjsKesehatan       String?  // NO BPJS KESEHATAN
    jabatan               String?  // JABATAN
    
    // ========== GAJI (SALARY) ==========
    gajiPokok             Decimal  @default(0) @db.Decimal(15, 0)  // Gaji Pokok
    
    // ========== TUNJANGAN ==========
    tunjanganJabatan      Decimal  @default(0) @db.Decimal(15, 0)  // Tunjangan Jabatan
    tunjanganPerumahan    Decimal  @default(0) @db.Decimal(15, 0)  // Tunjangan Perumahan
    
    // ========== POTONGAN PERSENTASE (optional) ==========
    pctBpjsTkJht          Decimal  @default(2) @db.Decimal(5, 2)   // % BPJS TK JHT (default 2%)
    pctBpjsTkJn           Decimal  @default(1) @db.Decimal(5, 2)   // % BPJS TK JN (default 1%)
    pctBpjsKesehatan      Decimal  @default(1) @db.Decimal(5, 2)   // % BPJS Kesehatan (default 1%)
    
    // ========== STATUS ==========
    isActive              Boolean  @default(true)
    tanggalMulaiKerja     DateTime?
    
    createdAt             DateTime @default(now())
    updatedAt             DateTime @updatedAt
    
    // Relations
    penggajian            PenggajianKaryawan[]
    
    @@index([namaKaryawan])
    @@index([devisi])
    @@index([isActive])
}

model PenggajianKaryawan {
    id                    String   @id @default(cuid())
    
    // Periode Gaji
    periodeBulan          Int      // 1-12
    periodeTahun          Int      // 2024, 2025, etc
    
    // Reference to Master Karyawan (optional for backward compatibility)
    masterKaryawanId      String?
    masterKaryawan        MasterKaryawan? @relation(fields: [masterKaryawanId], references: [id])
    
    // Identitas Karyawan (Column A-I from Excel)
    no                    Int?     // NO
    namaKaryawan          String   // NAMA KARYAWAN
    tktk                  String?  // TK/K (Status keluarga)
    gol                   String?  // GOL (Golongan)
    nomorRekening         String?  // NOMOR REKENING
    devisi                String?  // DEVISI
    noBpjsTk              String?  // NO BPJS TK
    noBpjsKesehatan       String?  // NO BPJS KESEHATAN
    jabatan               String?  // JABATAN
    
    // Tanggal Olah TBS / Tanggal Kerja (1-31) - stored as JSON
    // Format: { "1": "WK", "2": "Off", "3": "PH", ... }
    // Kategori: WK=Masuk Kerja, Off=Libur, PH=Hari Libur Nasional, Cuti (AL)=Cuti Tahunan,
    //           PC=Pinjam Cuti, Sakit (sc)=Sakit, P1=Libur tidak dibayar, M=Mangkir, SK=Skorsing
    tanggalKerja          Json?    // TANGGAL KERJA (kolom 1-31)
    
    // Data lembur per tanggal - stored as JSON
    // Format: { "1": { "x15": 60, "x2": 0, "x3": 0, "x4": 0 }, "2": { ... } }
    // x15=x1.5, x2=x2, x3=x3, x4=x4 dalam menit
    lemburDetail          Json?    // Detail lembur per tanggal (menit)
    
    // Total akumulasi lembur (kalkulasi otomatis)
    totalMenit            Int      @default(0)  // Total menit lembur
    totalMenitDibayar     Int      @default(0)  // Total menit dibayar (setelah dikalikan multiplier)
    
    // ========== HARI KERJA SECTION ==========
    hk                    Int      @default(0)  // HK (Hari Kerja)
    liburDibayar          Int      @default(0)  // Libur Dibayar
    hkTidakDibayar        Int      @default(0)  // HK Tidak Dibayar
    hkDibayar             Int      @default(0)  // HK Dibayar
    lemburHari            Float    @default(0)  // Lembur (hari) - backward compatibility
    
    // ========== GAJI (SALARY) ==========
    gajiPokok             Decimal  @default(0) @db.Decimal(15, 0)  // Gaji Pokok
    
    // ========== TUNJANGAN ==========
    tunjanganJabatan      Decimal  @default(0) @db.Decimal(15, 0)  // Tunjangan Jabatan
    tunjanganPerumahan    Decimal  @default(0) @db.Decimal(15, 0)  // Tunjangan Perumahan
    
    // ========== OVERTIME ==========
    overtime              Decimal  @default(0) @db.Decimal(15, 0)  // Overtime (rupiah)
    
    // ========== TOTAL SEBELUM POTONGAN ==========
    totalSebelumPotongan  Decimal  @default(0) @db.Decimal(15, 0)  // Total (sebelum potongan)
    
    // ========== POTONGAN ==========
    potKehadiran          Decimal  @default(0) @db.Decimal(15, 0)  // Potongan Kehadiran
    potBpjsTkJht          Decimal  @default(0) @db.Decimal(15, 0)  // Potongan BPJS TK JHT
    potBpjsTkJn           Decimal  @default(0) @db.Decimal(15, 0)  // Potongan BPJS TK JN
    potBpjsKesehatan      Decimal  @default(0) @db.Decimal(15, 0)  // Potongan BPJS Kesehatan
    potPph21              Decimal  @default(0) @db.Decimal(15, 0)  // Potongan PPH 21
    
    // ========== TOTAL POTONGAN ==========
    totalPotongan         Decimal  @default(0) @db.Decimal(15, 0)  // Total Potongan
    
    // ========== UPAH DITERIMA (NET PAY) ==========
    upahDiterima          Decimal  @default(0) @db.Decimal(15, 0)  // Upah Diterima
    
    createdAt             DateTime @default(now())
    updatedAt             DateTime @updatedAt
    
    @@index([periodeBulan, periodeTahun])
    @@index([namaKaryawan])
    @@index([devisi])
    @@index([masterKaryawanId])
}

// Model Pembayaran PR - Record pembayaran untuk PR Pembelian Langsung
model PembayaranPR {
    id                    String           @id @default(cuid())
    purchaseRequestId     String
    
    tanggalBayar          DateTime         @default(now())
    jumlahBayar           Float
    metodePembayaran      String?          // CASH, TRANSFER, GIRO, dll
    nomorReferensi        String?          // Nomor bukti bayar
    keterangan            String?
    dibayarOleh           String           // Username yang mencatat pembayaran
    
    createdAt             DateTime         @default(now())
    
    purchaseRequest       PurchaseRequest  @relation(fields: [purchaseRequestId], references: [id], onDelete: Cascade)
    
    @@index([purchaseRequestId])
    @@index([tanggalBayar])
}

// Model Pembayaran PO - Record pembayaran untuk Purchase Order
model PembayaranPO {
    id                    String         @id @default(cuid())
    purchaseOrderId       String
    
    tanggalBayar          DateTime       @default(now())
    jumlahBayar           Float
    metodePembayaran      String?        // CASH, TRANSFER, GIRO, dll
    nomorReferensi        String?        // Nomor bukti bayar
    keterangan            String?
    dibayarOleh           String         // Username yang mencatat pembayaran
    
    createdAt             DateTime       @default(now())
    
    purchaseOrder         PurchaseOrder  @relation(fields: [purchaseOrderId], references: [id], onDelete: Cascade)
    
    @@index([purchaseOrderId])
    @@index([tanggalBayar])
}
